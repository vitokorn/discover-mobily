{% extends 'base.html' %}
{% block title %}  {% endblock %}
{% block content %}
        <div style="column-gap: 16px; column-count: 3;">
        {% for p in pl %}
            <div id="{{ p['id'] }}" onclick="initElement('{{ p['id'] }}')">{{ p['name'] }}</div>
        {% endfor %}
        </div>
    <br>
    <br>
        <div id="playlist" class="flex-container">
        </div>
        <div id="tracks" class="flex-container">

        </div>
    <script>
          function initElement(id) {
              console.log(id)
              let url = 'https://api.spotify.com/v1/playlists/' + id + '?fields=name,id,description,images,tracks(items(track(name,preview_url,id,artists,album(artists,id,images))))'
              console.log(url)
              let xhr = new XMLHttpRequest()
              xhr.open('GET',url,true)
              xhr.setRequestHeader('Authorization', 'Bearer ' + '{{ user.access_token }}');
              xhr.send()
              xhr.onload = function (){
                  if (xhr.status === 200){
                      let data = JSON.parse(this.response)
                      console.log(data)
                      let tracks = document.getElementById('tracks')
                      tracks.innerHTML = ''
                      let name = data['name']
                      let description = data['description']
                      let image = data['images'][0]['url']
                      let playtrack = data['tracks']['items']
                      console.log(playtrack)


                      let playlistdiv = document.getElementById('playlist')
                      playlistdiv.innerHTML = ''
                      let names = document.createElement('div')
                      names.innerText = name
                      names.className = 'flex-item'
                      playlistdiv.appendChild(names)
                      let descriptions = document.createElement('div')
                      descriptions.innerText = description
                      description.className = 'flex-item'
                      playlistdiv.appendChild(descriptions)
                      let cover = document.createElement('div')
                      cover.className = 'col-3'
                      cover.style.backgroundImage = "url('"+image+"')"
                      cover.style.backgroundRepeat = 'no-repeat'
                      playlistdiv.appendChild(cover)
                      for (const pla of playtrack){
                          tracks.innerHTML += `<div id="num1" <div class="num2" id=${pla['track']['id']} style="background-image: url(${pla['track']['album']['images'][0]['url']});background-repeat: no-repeat;background-size: cover" onclick="playtrack('${pla['track']['id']}')">${pla['track']['name']}<audio type="audio/mpeg" preload="none" id="a_${pla['track']['id']}" src="${pla['track']['preview_url']}"></div></div>`
                      }

                  let zerosrc = document.querySelectorAll('[src=null]')
                  for (let z of zerosrc) {
                      let curr = z.id.replace('a_','')
                      document.getElementById(curr).style.opacity = '.5'
                  }

                  }
          }}
          function playtrack(id) {
              let all = document.querySelectorAll('[id^="a_"]');
              for (let elem of all) {
                  elem.pause()
              }
              let audio = document.getElementById('a_' + id)
              audio.play();
          }
    </script>
{% endblock %}